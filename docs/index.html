<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyTubes</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <!-- Sign-in page (shown when not authenticated) -->
    <div id="sign-in-page" class="sign-in-page">
        <div class="sign-in-container">
            <h1>MyTubes</h1>
            <p class="sign-in-subtitle">Your personal, distraction-free YouTube frontend</p>
            <p class="sign-in-description">
                Sign in with Google to pull your YouTube subscriptions, filter out Shorts,
                and organize channels into categories.
            </p>
            <button id="sign-in-btn" class="sign-in-btn">Sign in with Google</button>
        </div>
    </div>

    <!-- Main app (hidden until authenticated) -->
    <div id="app" class="app" style="display: none;">
        <header>
            <h1>MyTubes</h1>
            <div class="header-controls">
                <input type="search" id="search-bar" placeholder="Search videos...">
                <button id="refresh-btn" class="icon-btn" title="Refresh videos">&#x21bb;</button>
                <img id="user-avatar" class="user-avatar" src="" alt="User" title="Signed in">
                <button id="settings-btn" class="icon-btn" title="Settings">&#9881;</button>
                <button id="chat-toggle-btn" class="icon-btn" title="AI Chat">&#x1F4AC;</button>
                <button id="sign-out-btn" class="icon-btn" title="Sign out">&#x2192;</button>
            </div>
        </header>

        <nav id="category-tabs" class="category-tabs">
            <button class="category-tab active" data-category="all">All</button>
        </nav>

        <main id="video-grid-container">
            <!-- Video cards injected by script.js -->
        </main>

        <footer>
            <p>Powered by the YouTube Data API</p>
        </footer>

        <!-- Chat panel -->
        <div id="chat-panel" class="chat-panel">
            <div class="chat-header">
                <span>AI Category Manager</span>
                <button id="chat-close-btn" class="chat-close">&times;</button>
            </div>
            <div id="chat-connect" class="chat-connect">
                <p>Connect to OpenRouter to use AI-powered category management.</p>
                <button id="chat-connect-btn" class="action-btn">Connect OpenRouter</button>
            </div>
            <div id="chat-body" class="chat-body" style="display: none;">
                <div id="chat-messages" class="chat-messages"></div>
                <div class="chat-input-row">
                    <input type="text" id="chat-input" placeholder="e.g. create a category called Woodworking...">
                    <button id="chat-send-btn" class="action-btn">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button id="settings-close-btn" class="modal-close">&times;</button>
            </div>

            <div class="settings-section">
                <h3>Categories</h3>
                <p class="settings-note">Assign your subscribed channels to categories</p>
                <div id="category-manager">
                    <div class="category-actions">
                        <input type="text" id="new-category-input" placeholder="New category name...">
                        <button id="add-category-btn" class="action-btn">Add</button>
                    </div>
                    <div id="category-list"></div>
                </div>
            </div>

            <div class="settings-section">
                <h3>Channel Assignments</h3>
                <p class="settings-note">Drag or use dropdowns to assign channels to categories</p>
                <div id="channel-assignments"></div>
            </div>

            <div class="settings-section">
                <h3>Sync &amp; Cache</h3>
                <button id="resync-subs-btn" class="action-btn">Re-sync Subscriptions</button>
                <button id="clear-cache-btn" class="action-btn secondary">Clear Cache</button>
                <p id="sync-status" class="settings-status"></p>
            </div>

            <div class="settings-section">
                <h3>OpenRouter AI</h3>
                <p class="settings-note">Connect to OpenRouter to manage categories via AI chat</p>
                <div id="openrouter-settings">
                    <button id="openrouter-connect-btn" class="action-btn">Connect OpenRouter</button>
                    <div id="openrouter-connected" style="display: none;">
                        <span class="openrouter-status">Connected</span>
                        <button id="openrouter-disconnect-btn" class="action-btn secondary">Disconnect</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auto-suggest modal (shown after first subscription sync) -->
    <div id="suggest-modal" class="modal">
        <div class="modal-content suggest-modal-content">
            <div class="modal-header">
                <h2>Organize Your Channels</h2>
                <button id="suggest-close-btn" class="modal-close">&times;</button>
            </div>
            <p class="settings-note">We've auto-suggested categories based on your subscriptions. Review and adjust below, then save.</p>
            <div id="suggest-assignments"></div>
            <div class="suggest-actions">
                <button id="suggest-save-btn" class="action-btn">Save Assignments</button>
                <button id="suggest-skip-btn" class="action-btn secondary">Skip for Now</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
